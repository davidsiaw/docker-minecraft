#!/bin/bash
# -----------------------------------------------------------------------------
# docker-minecraft /start script
# -----------------------------------------------------------------------------

cd /data/;
if [ ! -f serverinstall_129_100131 ] ; then
    rm -rf .
    curl -JLO "https://api.feed-the-beast.com/v1/modpacks/public/modpack/129/100131/server/linux"
    chmod +x serverinstall_129_100131 
    ./serverinstall_129_100131 --dir /data --auto --force
    echo "Downloading mods"
    curl -L 'https://www.dropbox.com/scl/fi/96qa3cq5xltzy9f9u6oyp/ftbextramods.zip?rlkey=0kxf06dq2e342ck1pkludalk4&st=nnxag6wi&dl=0' > 'release.zip'
    unzip -o 'release.zip'
    rm release.zip
    mv *.jar ./mods
fi
if [[ -n "$MOTD" ]]; then
    sed -i "/motd\s*=/ c motd=$MOTD" /data/server.properties
fi
if [[ -n "$LEVEL" ]]; then
    sed -i "/level-name\s*=/ c level-name=$LEVEL" /data/server.properties
fi
if [[ -n "$OPS" ]]; then
    echo $OPS | awk -v RS=, '{print}' >> ops.txt
fi

if [ ! -f /data/eula.txt ]
then
    echo "eula=true" > /data/eula.txt
fi

sh run.sh
