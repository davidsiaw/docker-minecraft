#!/bin/bash
# -----------------------------------------------------------------------------
# docker-minecraft /start script
# -----------------------------------------------------------------------------

cd /data/;
if [ ! -f forge-1.18.2-40.2.26-installer.jar ] ; then
    rm -rf .
    curl -o 'forge-1.18.2-40.2.26-installer.jar' 'https://maven.minecraftforge.net/net/minecraftforge/forge/1.18.2-40.2.26/forge-1.18.2-40.2.26-installer.jar'
    java -jar forge-1.18.2-40.2.26-installer.jar --installServer
    echo "Downloading mods"
    curl -L 'https://github.com/brandongohwh/Custom1.18/archive/refs/tags/Release.zip' > 'release.zip'
    unzip 'release.zip'
    rm -rf config defaultconfigs mods resourcepacks
    mv Custom1.18-Release/* . && rm Custom1.18-Release
fi
if [[ -n "$MOTD" ]]; then
    sed -i "/motd\s*=/ c motd=$MOTD" /data/server.properties
fi
if [[ -n "$LEVEL" ]]; then
    sed -i "/level-name\s*=/ c level-name=$LEVEL" /data/server.properties
fi
if [[ -n "$OPS" ]]; then
    echo $OPS | awk -v RS=, '{print}' >> ops.txt
fi

if [ ! -f /data/eula.txt ]
then
    echo "eula=true" > /data/eula.txt
fi

sh run.sh
